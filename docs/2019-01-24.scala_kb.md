<!--
$theme: gaia
template: default
-->
<!-- page_number: true -->
<!-- $size: 16:9 -->
<!-- footer: 2019-01-24 Scalaé–¢è¥¿å‹‰å¼·ä¼š -->

# Scala / refined ã§
# \`å‹ã\`è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°


---
## è‡ªå·±ç´¹ä»‹

- æ— å¤§ä»‹
	- ![40%](images/prof_image.png)
	- Twitter: @hayasshi_
	- GitHub: hayasshi
- ChatWorkæ ªå¼ä¼šç¤¾
- Scala 2.9ç³»ã‹ã‚‰ä½¿ã„å§‹ã‚(2013å¹´é ƒ)
- å‹å¥½ãã€Akkaå¥½ã


---
# è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°


---
## è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯

å…¥åŠ›ã‚„çµæœãªã©ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æƒ³å®šå¤–ã®å€¤ã®å ´åˆã«ã¯å¼¾ãã“ã¨ã§
å…¨ä½“ã®å‹•ä½œã‚’æ­£å¸¸ã«ä¿ã¤

é˜²å¾¡çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚„ã‚Šæ–¹ã®ä¸€ã¤

`assert`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¤ã‹ã£ã¦æ¤œæŸ»ã™ã‚‹ã“ã¨ãŒå¤šã„


---
## Scalaã§ã®è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

```scala
val namePattern = "[A-Z][a-zA-Z0-9]{0,9}".r.pattern

case class User(id: Long, name: String, age: Int) {
  assert(id > 0)
  assert(namePattern.matcher(name).matches())
  assert(age >= 18)
  
  def changeName(name: String): User = {
    assert(namePattern.matcher(name).matches())
    this.copy(name = name)
  }
}
```


---
## Scalaã§ã®è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

```scala
val namePattern = "[A-Z][a-zA-Z0-9]{0,9}".r.pattern

case class UserId(value: Long) {
  assert(value > 0)
}
case class UserName(value: String) {
  assert(namePattern.matcher(value).matches())
}
case class UserAge(value: Int) {
  assert(value >= 18)
}

case class User(id: UserId, name: UserName, age: UserAge) {
  def changeName(name: UserName): User = {
    this.copy(name = name)
  }
}
```


---
## è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãƒ¡ãƒªãƒƒãƒˆ

- `fail fast` æƒ³å®šå¤–ã®å…¥åŠ›ãŒã‚ã‚Œã°æ—©æœŸã«ã‚¨ãƒ©ãƒ¼ã‚’ã‚ã’ã‚‹ã“ã¨ã§
ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã®å‹•ä½œã‚’ä¿è­·ã™ã‚‹
- `documentation` è¡¨æ˜ã®ã‚³ãƒ¼ãƒ‰è‡ªä½“ã§ä½•ã‚’æ±‚ã‚ã¦ã„ã‚‹ã‹ãŒæ˜ç¤ºã•ã‚Œ
èª­ã¿æ‰‹ãŒç†è§£ã—ã‚„ã™ããªã‚‹(ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿ƒé€²ã™ã‚‹)


---
## å®Ÿè¡Œæ™‚ã«æ¤œçŸ¥ã‹ã
## åˆ¶ç´„ã‚’èª²ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œçŸ¥ã§ãã‚Œã°ãªã


---
# refined

---
## refinedã¨ã¯

---
## note: refinedã‚’çŸ¥ã£ãŸæ—¥

---
## refinedã§æ›¸ãå ´åˆ

---
## refinedã®ãƒ¡ãƒªãƒƒãƒˆ

---
## refinedã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

---
### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé…ããªã‚‹

---
### å®Ÿè¡Œé€Ÿåº¦

[sbt-jmh](https://github.com/ktoso/sbt-jmh)ã‚’ã¤ã‹ã£ã¦ç°¡æ˜“ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿæ–½

```
sbt clean "jmh:run -i 10 -wi 10 -f1 -t1"
```

```
[info] Benchmark                      Mode  Cnt    Score   Error  Units
[info] Main.runCreateAssertObjects   thrpt   10  867.783 Â± 6.132  ops/s
[info] Main.runCreateRefinedObjects  thrpt   10  229.468 Â± 9.618  ops/s
```

4å€ãã‚‰ã„é…ã„ ğŸ˜‡

---
## refinedã®æ´»ç”¨

ã‚³ãƒ³ãƒ†ãƒŠå…¨ç››ã§ yaml ã‚’æ›¸ãã“ã¨ãŒå¤šã„

json <=> yaml ã¯å¤‰æ›ã§ãã‚‹ã®ã§ Scala ã§ json ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ãªã©ã§ã€å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆ¶ç´„ã«ã¤ã‹ãˆãªã„ã‹

```scala
case class KubernetesManifest(
  kind: ResourceType.Pod,
  metadataName: String Refined NonEmpty Refined MaxSize[W.`24`.T],
  ...
  clusterIp: String Refined IPv4,
)
```


---
## ã¾ã¨ã‚

- refined ã‚’ä½¿ã†ã“ã¨ã§å‹ã‚’ã¤ã‹ã£ã¦è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ãã‚‹
- refined ã®å®Ÿè¡Œã¯é…ãã†ã«è¦‹ãˆã‚‹...
- å®Ÿè¡Œé€Ÿåº¦ãŒãã“ã¾ã§æ±‚ã‚ã‚‰ã‚Œãªã„ä½•ã‹ã«ä½¿ãŠã†

#### Scala è¨€èªè‡ªä½“å«ã‚ä»Šå¾Œã®é€²åŒ–ã«æœŸå¾…